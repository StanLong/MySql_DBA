# @Configuration 配置

@Configuration 告诉 SpringBoot 这是一个配置类（配置文件）

- 定义两个组件

  ```java
  package com.stanlong.bean;
  
  import lombok.*;
  
  @Getter
  @Setter
  @ToString
  public class User {
      private String name;
      private int age;
  
      // 使用@Impor导入User组件时，组件中必须要有无参构造方法
      public User(){
  
      }
  
      private Pet pet; // 组件依赖
      
      public User(String name, int age){
          this.name = name;
          this.age = age;
      }
  }
  ```

  ```java
  package com.stanlong.bean;
  
  import lombok.*;
  
  @Getter
  @Setter
  @ToString
  @AllArgsConstructor
  @NoArgsConstructor
  public class Pet {
      private String name;
  }
  ```

- 基本使用

  ```java
  package com.stanlong.config;
  
  import com.stanlong.bean.Pet;
  import com.stanlong.bean.User;
  import org.springframework.context.annotation.Bean;
  import org.springframework.context.annotation.Configuration;
  import org.springframework.context.annotation.Import;
  
  /**
   * 1、配置类里面使用@Bean标注在方法上给容器注册组件，默认是单实例的
   * 2、配置类本身也是组件
   * 3、proxyBeanMethods：代理bean的方法
   *   proxyBeanMethods = true（保证每个@Bean方法被调用多少次返回的组件都是单实例的）（默认单例）(也被称为 Full 全配置)
   *   proxyBeanMethods = false（每个@Bean方法被调用多少次返回的组件都是新创建的）（多例）（也被称为 Lite 轻量级配置）
   *
   * 4、@Import({User.class, DBHelper.class})
   *   调用组件的无参构造器，创建出指定类型的对象放到容器中。默认组件的名字就是全类名
   */
  @Import({User.class})
  @Configuration(proxyBeanMethods = false) // 告诉SpringBoot这是一个配置类 == 配置文件
  public class MyConfig {
  
      @Bean //给容器中添加组件。以方法名作为组件的id。返回类型就是组件类型。返回的值，就是组件在容器中的实例
      public User user01(){
          User zhangsan = new User("zhangsan", 18);
          //user组件依赖了Pet组件
          zhangsan.setPet(tomcatPet());
          return zhangsan;
      }
  
      @Bean("tom") // 如果不想以方法名作为组件id，可以给它一个自定义的名字,比如 tom
      public Pet tomcatPet(){
          return new Pet("tomcat");
      }
  }
  ```

- 测试

  ```java
  package com.stanlong;
  
  import com.stanlong.bean.Pet;
  import com.stanlong.bean.User;
  import org.springframework.boot.SpringApplication;
  import org.springframework.boot.autoconfigure.SpringBootApplication;
  import org.springframework.context.ConfigurableApplicationContext;
  
  @SpringBootApplication()
  public class AdminApplication {
      public static void main(String[] args) {
          // 返回IOC 容器
          ConfigurableApplicationContext run = SpringApplication.run(AdminApplication.class, args);
  
          // 查看容器里面的组件
          // String[] names = run.getBeanDefinitionNames();
          // for(String name : names){
          //     System.out.println(name);
          // }
  
          // 从容器中获取组件
          // 如果@Configuration(proxyBeanMethods = true)，单例，SpringBoot 不会重复创建对象。如果是false，那就是多例
          User user01 = run.getBean("user01", User.class);
          User user02 = run.getBean("user01", User.class);
          System.out.println(user01 == user02); // true, 注册的组件默认是单实例的
  
          // 单例模式下，组件依赖验证
          User user03 = run.getBean("user01", User.class);
          Pet tom = run.getBean("tom", Pet.class);
          System.out.println("用户的宠物："+(user03.getPet() == tom)); // true
  
          System.out.println("==========================================");
  
          // 获取容器中的所有User组件
          String[] beanNamesForType = run.getBeanNamesForType(User.class);
          for(String beanName : beanNamesForType){
              System.out.println(beanName);
          }
          // 控制台打印
          // com.stanlong.bean.User 这个是 @Import 组件导入的
          // user01 这个是 @Bean 注解添加进来的
  
      }
  }
  ```

- 最佳实践

  - 配置 类组件之间**无依赖关系**用Lite模式加速容器启动过程，减少判断

  - 配置 类组件之间**有依赖关系**，方法会被调用得到之前单实例组件，用Full模式（默认）



# @Conditional 条件装配

**条件装配：满足Conditional指定的条件，则进行组件注入**


以@ConditionalOnMissingBean举例说明

```java
@Configuration(proxyBeanMethods = false)
@ConditionalOnMissingBean(name = "tom")//没有tom名字的Bean时，MyConfig类的Bean才能生效。
public class MyConfig {

    @Bean
    public User user01(){
        User zhangsan = new User("zhangsan", 18);
        zhangsan.setPet(tomcatPet());
        return zhangsan;
    }

    @Bean("tom22")
    public Pet tomcatPet(){
        return new Pet("tomcat");
    }
}

public static void main(String[] args) {
    //1、返回我们IOC容器
    ConfigurableApplicationContext run = SpringApplication.run(MainApplication.class, args);

    //2、查看容器里面的组件
    String[] names = run.getBeanDefinitionNames();
    for (String name : names) {
        System.out.println(name);
    }

    boolean tom = run.containsBean("tom");
    System.out.println("容器中Tom组件："+tom);//false

    boolean user01 = run.containsBean("user01");
    System.out.println("容器中user01组件："+user01);//true

    boolean tom22 = run.containsBean("tom22");
    System.out.println("容器中tom22组件："+tom22);//true

}
```

# @ImportResource导入Spring配置文件

比如，公司使用bean.xml文件生成配置bean，然而你为了省事，想继续复用bean.xml，@ImportResource粉墨登场。

bean.xml：

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans ...">

    <bean id="haha" class="com.lun.boot.bean.User">
        <property name="name" value="zhangsan"></property>
        <property name="age" value="18"></property>
    </bean>

    <bean id="hehe" class="com.lun.boot.bean.Pet">
        <property name="name" value="tomcat"></property>
    </bean>
</beans>
```

使用方法：

```java
@ImportResource("classpath:beans.xml")
public class MyConfig {
...
}
```

测试类：

```java
public static void main(String[] args) {
    //1、返回我们IOC容器
    ConfigurableApplicationContext run = SpringApplication.run(MainApplication.class, args);

	boolean haha = run.containsBean("haha");
	boolean hehe = run.containsBean("hehe");
	System.out.println("haha："+haha);//true
	System.out.println("hehe："+hehe);//true
}
```

# @ConfigurationProperties配置绑定

如何把JaveBean和配置文件绑定

传统方法：

```java
public class getProperties {
     public static void main(String[] args) throws FileNotFoundException, IOException {
         Properties pps = new Properties();
         pps.load(new FileInputStream("a.properties"));
         Enumeration enum1 = pps.propertyNames();//得到配置文件的名字
         while(enum1.hasMoreElements()) {
             String strKey = (String) enum1.nextElement();
             String strValue = pps.getProperty(strKey);
             System.out.println(strKey + "=" + strValue);
             //封装到JavaBean。
         }
     }
 }
```

---

SpringBoot提供一种配置配置绑定：

@ConfigurationProperties + @Component

假设有配置文件application.properties

```properties
mycar.brand=BYD
mycar.price=100000
```

只有在容器中的组件，才会拥有SpringBoot提供的强大功能

```java
@Component
@ConfigurationProperties(prefix = "mycar") // 绑定之后会把配置文件中的值 封装到 Car 的属性中 {"brand":"BYD","price":100000}
public class Car {
...
}
```

---

SpringBoot另一种配置配置绑定：

@ConfigurationProperties + @EnableConfigurationProperties

1. 开启Car配置绑定功能
2. 把这个Car这个组件自动注册到容器中


```java
@EnableConfigurationProperties(Car.class)
public class MyConfig {
...
}
```

```java
@ConfigurationProperties(prefix = "mycar")
public class Car {
...
}
```
